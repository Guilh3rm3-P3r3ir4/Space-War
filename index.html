<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Space War</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="home-screen">
        <img id="home-bg" src="./imagens/home.jpeg" alt="Home">
        <img id="btn-start" src="./imagens/botao_start.png" alt="Start">
    </div>

    <canvas id="tela" width="510" height="680"></canvas>

    <!-- Tela de Game Over -->
    <div id="gameover-screen" style="display:none;">
        <img id="gameover-bg" src="./imagens/game_over.jpeg" alt="Game Over">
        <img id="recomecar-btn" src="./imagens/botao_recomecar.png" alt="Recomeçar">
        <img id="sair-btn" src="./imagens/botao_sair.png" alt="Sair">
    </div>

    <script type="module">
        const btnStart = document.getElementById("btn-start");
        const homeScreen = document.getElementById("home-screen");
        const canvas = document.getElementById("tela");
        const gameOverScreen = document.getElementById("gameover-screen");
        const recomecarBtn = document.getElementById("recomecar-btn");
        const sairBtn = document.getElementById("sair-btn");

        // Detectar se é celular / touch
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        // Inicializar variáveis de movimento por touch globalmente
        window.moveX = 0;
        window.moveY = 0;

        // Variável para armazenar touchArea (será criada ao iniciar o jogo)
        let touchArea = null;

        // Função para criar o joystick invisível
        function createTouchArea() {
            if (isTouchDevice && !touchArea) {
                touchArea = document.createElement("div");
                touchArea.id = "touch-area";
                document.body.appendChild(touchArea);

                // Estilo do touch area (ocupando toda a tela)
                touchArea.style.position = "absolute";
                touchArea.style.top = "0";
                touchArea.style.left = "0";
                touchArea.style.width = "100vw";
                touchArea.style.height = "100vh";
                touchArea.style.zIndex = "1000"; // acima do canvas
                touchArea.style.touchAction = "none"; // evita scroll
                touchArea.style.background = "transparent";

                let touchStartX = 0;
                let touchStartY = 0;

                touchArea.addEventListener("touchstart", (e) => {
                    const touch = e.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;
                });

                touchArea.addEventListener("touchmove", (e) => {
                    const touch = e.touches[0];
                    window.moveX = touch.clientX - touchStartX;
                    window.moveY = touch.clientY - touchStartY;

                    // Limitar valor máximo de movimentação
                    const maxMove = 30; // força do joystick
                    window.moveX = Math.max(-maxMove, Math.min(maxMove, window.moveX));
                    window.moveY = Math.max(-maxMove, Math.min(maxMove, window.moveY));

                    e.preventDefault(); // impede scroll da página
                });

                touchArea.addEventListener("touchend", () => {
                    window.moveX = 0;
                    window.moveY = 0;
                });
            }
        }

        // Função para destruir o joystick
        function destroyTouchArea() {
            if (touchArea) {
                touchArea.remove();
                touchArea = null;
                window.moveX = 0;
                window.moveY = 0;
            }
        }

        btnStart.addEventListener("click", () => {
            homeScreen.style.display = "none";
            canvas.style.display = "block";
            createTouchArea(); // ativa joystick ao iniciar jogo

            import("./jogo.js");
        });
        // Recomeçar jogo sem voltar para Home
        recomecarBtn.addEventListener("click", () => {
            destroyTouchArea(); // desativa joystick
            gameOverScreen.style.display = "none";
            canvas.style.display = "block";
            createTouchArea(); // reativa joystick para próxima partida
            window.resetGame(); // reseta todas as variáveis
            loop(); // reinicia o loop do jogo
        });






        // Sair do jogo
        sairBtn.addEventListener("click", () => {
            destroyTouchArea(); // desativa joystick ao sair
            gameOverScreen.style.display = "none";
            homeScreen.style.display = "flex"; // volta para home
        });
    </script>

</body>

</html>